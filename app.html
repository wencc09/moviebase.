

<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MovieBaseï½œä¸»ç«™</title>

<!-- âœ… å…ˆå¥—ç”¨å·²å„²å­˜ä¸»é¡Œï¼Œé¿å…é–ƒä¸€ä¸‹ -->
<script>
(function(){
const t = localStorage.getItem("moviebase_theme") || localStorage.getItem("theme");
if(t === "light" || t === "dark") document.documentElement.setAttribute("data-theme", t);
})();
</script>

<link rel="stylesheet" href="./assets/theme.css?v=2025122602">
<link rel="stylesheet" href="./assets/style.css?v=2025122602">
<link rel="stylesheet" href="./assets/records.css?v=2025122602">


<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
.tabsWrap{ margin-top: 16px; display:grid; gap:14px; }
.tabPanel{ display:none; }
.tabPanel.is-on{ display:block; }

.pill.is-active{
border-color: rgba(132,227,232,.35);
box-shadow: 0 0 0 4px rgba(132,227,232,.10);
}

.bottomNav{
position:fixed; left:12px; right:12px; bottom:12px; z-index:60;
border:1px solid var(--stroke);
background: rgba(10,14,26,.55);
backdrop-filter: blur(14px);
-webkit-backdrop-filter: blur(14px);
border-radius:18px;
display:none;
padding:10px;
gap:10px;
justify-content:space-between;
}
.bottomNav .pill{ flex:1; justify-content:center; white-space:nowrap; }
@media (max-width: 860px){
.bottomNav{ display:flex; }
.wrap{ padding-bottom: 120px; }
.navLinks{ display:none; }
}

.toolRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
</style>
</head>

<body>
<div class="bg-float"></div>

<div class="topbar">
<div class="nav">
<div class="brand">
<div class="logoDot"></div>
<button class="btn" id="themeToggle" type="button">Theme</button>
<div class="brandTitle">
<b>MovieBase</b>
<span>ä¸»ç«™ï¼ˆå››åˆ†é ï¼‰</span>
</div>
</div>

<div class="navLinks" id="appTabs">
<button class="pill is-active" type="button" data-tab="lobby">å½±é™¢å¤§å»³</button>
<button class="pill" type="button" data-tab="hall">æ¼‚æµ®å½±å»³</button>
<button class="pill" type="button" data-tab="records">è§€å½±ç´€éŒ„</button>
<button class="pill" type="button" data-tab="account">æˆ‘çš„å¸³æˆ¶</button>
</div>

<div class="rightBox">
<span class="badge" id="authBadge">ç›®å‰ï¼šè®€å–ä¸­â€¦</span>
<img class="avatar" id="authPic" alt="">
<span class="badge" id="authName">...</span>

<button class="btn" id="btnOpenLogin" type="button">ç«‹å³ç™»å…¥</button>
<button class="btn danger" id="btnLogout" type="button" style="display:none;">ç™»å‡º</button>
</div>
</div>
</div>

<div class="wrap">
<div class="tabsWrap">

<!-- âœ… lobby -->
<section class="card tabPanel is-on" id="tab-lobby">
<h2>ğŸ¬ å½±é™¢å¤§å»³ï¼ˆä¸»åˆ†é ï¼‰</h2>
<div class="muted">
é€™è£¡æ˜¯ä½ çš„ã€Œæˆ¿é–“å…¥å£ã€ï¼šä½ ä¹‹å¾Œå¯ä»¥æ”¾ç½®å¿«é€Ÿå°è¦½ã€ç«™å…§å…¬å‘Šã€æœ€æ–°è²¼æ–‡ç²¾é¸ã€‚
</div>
<div class="hr"></div>

<section class="card" id="nickCard" style="margin-top:12px; display:none;">
<div class="cardTitle">æš±ç¨±è¨­å®š</div>
<div class="muted" id="nickStatus" style="margin:8px 0;">è®€å–ä¸­...</div>

<div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
<input id="nicknameInput" type="text" maxlength="30"
placeholder="è¼¸å…¥ä½ çš„æš±ç¨±ï¼ˆæœ€å¤š30å­—ï¼‰"
style="flex:1; min-width:220px;"
/>
<button class="btn" id="btnSaveNickname" type="button">å„²å­˜</button>
</div>

<div class="muted" style="margin-top:8px;">
â€» æš±ç¨±æœƒç”¨æ–¼è²¼æ–‡/ç•™è¨€é¡¯ç¤ºï¼ˆä¹‹å¾Œæˆ‘å€‘å†æ¥åˆ°è²¼æ–‡ç‰†ï¼‰
</div>
</section>

<section class="card" id="globalRecCard" style="margin-top:12px;">
<div class="cardTitle" style="display:flex; align-items:center; justify-content:space-between;">
<span> ç«™å…§ç†±é–€æ¨è–¦</span>
<button class="btn" id="btnGlobalRecReload" type="button">é‡æ–°æ•´ç†</button>
</div>

<div class="muted" style="margin-top:6px;">

</div>

<!-- cardsGrid / recCard ä½ å·²ç¶“æœ‰ records.cssï¼Œæ‰€ä»¥é€™è£¡èƒ½ç›´æ¥æ²¿ç”¨ -->
<div class="cardsGrid" id="globalRecBox" style="margin-top:10px;"></div>
</section>

<div class="toolRow">
<button class="btn" type="button" data-tabjump="hall">å»æ¼‚æµ®å½±å»³</button>
<button class="btn" type="button" data-tabjump="records">å»è§€å½±ç´€éŒ„</button>
</div>
</section>

<section id="tab-hall" class="tabPanel">
<div class="cinemaScreen">
<div class="cinemaBezel" aria-hidden="true"></div>
<div class="cinemaGrain" aria-hidden="true"></div>

<div class="cinemaHeader">
<div class="cinemaTitle">
<div class="cinemaIcon">ğŸ¿</div>
<div>
<div class="hTitle">æ¼‚æµ®å½±å»³</div>
<div class="hSub">åƒåœ¨çœ‹é›»å½±ä¸€æ¨£æ»‘å‹•è²¼æ–‡ã€‚ç”¨ #hashtag æˆ–é—œéµå­—æœå°‹åŒå¥½ã€‚</div>
</div>
</div>

<div class="cinemaActions">
<input class="input" id="postSearch" placeholder="æœå°‹ #hashtag æˆ–é—œéµå­—â€¦" />
<button class="btn" id="btnRefreshPosts" type="button">æ›´æ–°</button>
</div>
</div>

<div class="cinemaBody">
<!-- å¯ä¼¸ç¸®ï¼šé¿å…å¯¬åº¦ä¸å¤ ã€ä¹Ÿä¸æœƒæ“ å£ç•«é¢ -->
<details class="composer" id="composerBox">
<summary class="composerSummary">
<span>ï¼‹ æ–°å¢è²¼æ–‡</span>
<span class="muted" id="composerHint">ï¼ˆç™»å…¥å¾Œå¯ç™¼æ–‡ / æŒ‰è®š / ç•™è¨€ï¼‰</span>
</summary>

<form id="postForm" class="composerForm">
<div class="row">
<input class="input" id="postTitle" placeholder="æ¨™é¡Œï¼ˆå¯ç•™ç©ºï¼‰" maxlength="40" />
<select class="input" id="postKind">
<option value="movie">é›»å½±</option>
<option value="series">å½±é›†</option>
<option value="anime">å‹•ç•«</option>
<option value="other">å…¶ä»–</option>
</select>
</div>

<label class="field">
<span class="label">ç…§ç‰‡ï¼ˆæœ€å¤š4å¼µï¼‰</span>
<input id="postPhotos" type="file" accept="image/*" multiple />
<div id="photoHint" class="muted">å¯é¸ 1ï½4 å¼µï¼ˆå»ºè­°æ¯å¼µ 1.5MB å…§ï¼‰</div>
<div id="photoPreview" class="photoPreview"></div>
</label>

<textarea class="input" id="postContent" rows="3"
placeholder="æƒ³èªªä»€éº¼ï¼Ÿ"
maxlength="500"></textarea>

<div class="row">
<input class="input" id="postTags" placeholder="#hashtagï¼ˆç”¨ç©ºç™½åˆ†éš”ï¼‰" />
<select class="input" id="postMood">
<option value="5">â˜…â˜…â˜…â˜…â˜…</option>
<option value="4">â˜…â˜…â˜…â˜…</option>
<option value="3">â˜…â˜…â˜…</option>
<option value="2"> â˜…â˜…</option>
<option value="1"> â˜…</option>
</select>
<button class="btn primary" id="btnPostSubmit" type="submit">ç™¼ä½ˆ</button>
</div>

<div class="muted" style="line-height:1.5">
è¨ªå®¢åªèƒ½ç€è¦½ï¼›ç™»å…¥å¾Œæ‰èƒ½ç™¼æ–‡/æŒ‰è®š/ç•™è¨€ï¼ˆç¬¦åˆä½ çš„æ¬Šé™çŸ©é™£ï¼‰ã€‚ 
</div>
</form>
</details>

<div id="postList" class="postList"></div>

<div class="cinemaVignette" aria-hidden="true"></div>
</div>
</div>
</section>


<!-- âœ… records -->
<section class="card tabPanel" id="tab-records">
<div id="recordsMount">
<div class="muted">Records è¼‰å…¥ä¸­...</div>
</div>
</section>


<!-- âœ… account -->
<section class="card tabPanel" id="tab-account">
<h2>ğŸ‘¤ æˆ‘çš„å¸³æˆ¶</h2>
<div class="muted" id="accInfo">è®€å–ä¸­â€¦</div>
<div class="hr"></div>
        <div class="muted">
        
        <div class="toolRow">
          <button class="btn" id="btnGoMyPosts" type="button">æˆ‘ç™¼éçš„è²¼æ–‡</button>
          <button class="btn" id="btnGoMyLikes" type="button">æˆ‘æŒ‰è®šçš„è²¼æ–‡</button>
          <button class="btn" id="btnGoMyComments" type="button">æˆ‘ç•™è¨€éçš„è²¼æ–‡</button>
          <!-- (å¯é¸) æƒ³å›åˆ°å…¨éƒ¨è²¼æ–‡å°±åŠ é€™é¡† -->
          <button class="btn" id="btnGoAllPosts" type="button">å…¨éƒ¨è²¼æ–‡</button>
</div>

<div class="muted" id="feedHint" style="margin-top:10px;">
  é»ä¸Šé¢æŒ‰éˆ•å¾Œæœƒè·³åˆ°ã€Œæ¼‚æµ®å½±å»³ã€ä¸¦å¥—ç”¨ç¯©é¸ã€‚
</div>

</section>

</div>
</div>

<nav class="bottomNav" id="bottomNav">
<button class="pill is-active" type="button" data-tab="lobby">å¤§å»³</button>
<button class="pill" type="button" data-tab="hall">å½±å»³</button>
<button class="pill" type="button" data-tab="records">ç´€éŒ„</button>
<button class="pill" type="button" data-tab="account">å¸³æˆ¶</button>
</nav>

<!-- ç™»å…¥ modal -->
<div class="modal" id="loginModal">
<div class="modalBox fadeIn">
<h3>ç™»å…¥ä»¥å•Ÿç”¨å®Œæ•´åŠŸèƒ½</h3>
<div class="small">Google ç”¨æˆ¶æ‰å¯ç´€éŒ„èˆ‡äº’å‹•ï¼›è¨ªå®¢åªèƒ½ç€è¦½ã€‚</div>
<div class="hr"></div>
<div id="gsiBtn"></div>
<div class="hr"></div>
<button class="btn" id="btnGuest" type="button">æˆ‘å…ˆç”¨è¨ªå®¢</button>
</div>
</div>

<div class="toast" id="toast"></div>

<script src="./assets/app.js?v=20251226_2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="./assets/records-ui.js?v=20251226_3" defer></script>

<script>
(function(){
function tryMount(){
if(!window.Records || !Records.mount) return;

// ä½ ä¸»ç«™çš„ records hash æ˜¯ #records
const inRecords = (location.hash || "").includes("records");
const mountEl = document.getElementById("recordsMount");
if(!inRecords || !mountEl) return;

// é¿å…é‡è¤‡æ›è¼‰
if(mountEl.dataset.mounted === "1") return;
mountEl.dataset.mounted = "1";

Records.mount(mountEl);
}

window.addEventListener("hashchange", tryMount);
window.addEventListener("load", () => setTimeout(tryMount, 50));

// ä¿éšªï¼ˆæœ‰äº› SPA ä¸ä¸€å®šè§¸ç™¼ hashchangeï¼‰
setInterval(tryMount, 600);
})();
</script>


<script>
function waitForMBReady(timeoutMs = 6000){
const start = Date.now();
return new Promise((resolve)=>{
const tick = ()=>{
if(window.MB && MB.state && MB.state.mode && MB.state.mode !== "unknown") return resolve(true);
if(Date.now() - start > timeoutMs) return resolve(false);
setTimeout(tick, 80);
};
tick();
});
}

function setActivePills(tab){
document.querySelectorAll("[data-tab]").forEach(el=>{
el.classList.toggle("is-active", el.dataset.tab === tab);
});
}

function showTab(tab){
const tabs = ["lobby","hall","records","account"];
tabs.forEach(t=>{
const panel = document.getElementById("tab-"+t);
if(!panel) return;
panel.classList.toggle("is-on", t === tab);
});
setActivePills(tab);
history.replaceState(null, "", "#"+tab);
}

async function safeGoTab(tab){
if(tab === "records"){
if(!MB_requireLogin("è§€å½±ç´€éŒ„")) {
showTab("lobby");
return;
}
}

showTab(tab);

// âœ… åˆ‡åˆ°å¤§å»³å°±è¼‰å…¥ç«™å…§æ¨è–¦ï¼ˆè‹¥å‡½å¼å­˜åœ¨ï¼‰
if(tab === "lobby" && typeof window.MB_loadGlobalRecs === "function"){
window.MB_loadGlobalRecs();
}
}

// âœ… è®“ records-ui.js å¯ä»¥å‘¼å«åˆ‡åˆ†é ï¼ˆå¾ˆé‡è¦ï¼‰
window.MB_goTab = safeGoTab;


window.addEventListener("load", async ()=>{
await waitForMBReady();

if (!window.MB) {
console.error("app.js è¼‰å…¥å¤±æ•—ï¼ŒMB æ²’å»ºç«‹ï¼ˆå…ˆä¿® app.js çš„ SyntaxErrorï¼‰");
return;
}


const hash = (location.hash || "#lobby").slice(1);
const wanted = ["lobby","hall","records","account"].includes(hash) ? hash : "lobby";
await safeGoTab(wanted);

document.getElementById("appTabs")?.addEventListener("click",(e)=>{
const b = e.target.closest("[data-tab]");
if(!b) return;
safeGoTab(b.dataset.tab);
});

document.getElementById("bottomNav")?.addEventListener("click",(e)=>{
const b = e.target.closest("[data-tab]");
if(!b) return;
safeGoTab(b.dataset.tab);
});

document.querySelectorAll("[data-tabjump]").forEach(btn=>{
btn.addEventListener("click", ()=> safeGoTab(btn.dataset.tabjump));
});

// records guard text
// records guard text
const recordsGuard = document.getElementById("recordsGuardText");
if (recordsGuard) {
recordsGuard.textContent =
(MB.state.mode === "user")
? "âœ… å·²ç™»å…¥ï¼šå¯ä»¥é–‹å§‹åšç´€éŒ„ UIï¼ˆä¸‹ä¸€æ­¥æ¥è³‡æ–™ï¼‰"
: "ğŸ”’ è¨ªå®¢ï¼šæ­¤é æœƒè¢«æ“‹ï¼ˆå·²ç¬¦åˆè¦æ ¼ï¼Œé»åŠŸèƒ½æœƒè·³ç™»å…¥ï¼‰";
}

document.getElementById("btnAddRecord")?.addEventListener("click", ()=>{
if(!MB_requireLogin("æ–°å¢ç´€éŒ„")) return;
toast("ä¸‹ä¸€æ­¥æ‰æœƒåšï¼šæ–°å¢ç´€éŒ„è¡¨å–®");
});


// account info
const acc = document.getElementById("accInfo");
const isUser = (MB.state.mode === "user" && MB.state.user);
if(isUser){
const nm = MB.state.user.name || MB.state.user.email || "";
acc.innerHTML = `âœ… å·²ç™»å…¥<br>æš±ç¨±ï¼š<b>${nm}</b>`;
}else{
acc.innerHTML = `ğŸ‘€ è¨ªå®¢æ¨¡å¼ï¼ˆåªèƒ½è§€çœ‹ï¼‰<br>ç™»å…¥å¾Œæ‰æœƒæœ‰ï¼šæˆ‘çš„è²¼æ–‡ / å·²æŒ‰è®šæ”¶è—`;
}
});

          // âœ… Account buttons -> go to hall + filter feed
      function bindFeedBtn(id, mode){
        const btn = document.getElementById(id);
        if(!btn || btn.dataset.bound) return;
        btn.dataset.bound = "1";

        btn.addEventListener("click", async ()=>{
          if(!MB_requireLogin("æŸ¥çœ‹æ¸…å–®")) return;

          // å…ˆåˆ‡åˆ° hallï¼ˆå› ç‚ºè²¼æ–‡ç‰†åœ¨ tab-hallï¼‰
          await safeGoTab("hall");

          // å†å¥—ç”¨ç¯©é¸ä¸¦åˆ·æ–°
          if (typeof window.MB_showFeed === "function") {
            await window.MB_showFeed(mode);
          } else if (typeof window.MB_setFeedMode === "function" && typeof window.MB_refreshPosts === "function") {
            window.MB_setFeedMode(mode);
            await window.MB_refreshPosts(true);
            document.getElementById("postList")?.scrollIntoView({behavior:"smooth", block:"start"});
          } else {
            toast("æ‰¾ä¸åˆ°è²¼æ–‡ç¯©é¸å‡½å¼ï¼ˆè«‹ç¢ºèª app.js å·²åŠ å…¥ MB_showFeed / MB_setFeedModeï¼‰");
          }
        });
      }

      bindFeedBtn("btnGoMyPosts", "mine");
      bindFeedBtn("btnGoMyLikes", "liked");
      bindFeedBtn("btnGoMyComments", "commented");
      bindFeedBtn("btnGoAllPosts", "all"); // (å¯é¸)


</script>


<div id="commentModal" class="mbModal" aria-hidden="true">
<div class="mbModalBackdrop" data-close="1"></div>

<div class="mbModalCard" role="dialog" aria-modal="true">
<div class="mbModalHead">
<div class="mbModalTitle" id="commentModalTitle">ç•™è¨€</div>
<button class="mbModalClose" id="commentModalClose" type="button">âœ•</button>
</div>

<div id="commentList" class="commentList"></div>

<div class="commentComposer">
<div id="commentHint" class="muted"></div>
<form id="commentForm" class="commentForm">
<input id="commentInput" type="text" placeholder="å¯«ä¸‹ç•™è¨€â€¦" maxlength="500" />
<button id="commentSend" type="submit">é€å‡º</button>
</form>
</div>
</div>
</div>



</body>
</html>
