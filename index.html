<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MovieBase｜漂浮影廳 × 觀影日記</title>
  <meta name="theme-color" content="#0B0F19" />

  <!-- Fonts (特別一點，但仍好讀) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root{
      --bg0:#0B0F19;
      --bg1:#0F172A;
      --glass: rgba(16,26,51,.62);
      --stroke: rgba(125,211,238,.18);
      --text:#E5E7EB;
      --muted:#A1A1AA;
      --purple:#7C3AED;
      --cyan:#22D3EE;
      --pink:#FB7185;
      --ok:#34D399;
      --danger:#FB7185;
      --shadow: 0 30px 120px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:"Space Grotesk","Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:
        radial-gradient(900px 450px at 15% 10%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(900px 520px at 85% 15%, rgba(34,211,238,.22), transparent 60%),
        radial-gradient(900px 520px at 70% 80%, rgba(251,113,133,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* subtle film grain */
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.18;
      pointer-events:none;
    }

    /* floating particles */
    .stars{
      position:fixed; inset:-20vh -10vw;
      background:
        radial-gradient(2px 2px at 15% 25%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(2px 2px at 65% 15%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(1.5px 1.5px at 80% 35%, rgba(255,255,255,.14), transparent 60%),
        radial-gradient(2px 2px at 30% 70%, rgba(255,255,255,.16), transparent 60%),
        radial-gradient(1.5px 1.5px at 70% 78%, rgba(255,255,255,.12), transparent 60%);
      filter: blur(.2px);
      animation: drift 14s ease-in-out infinite alternate;
      opacity:.9;
      pointer-events:none;
    }
    @keyframes drift{
      from{transform:translate3d(-10px,-10px,0)}
      to{transform:translate3d(12px,16px,0)}
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 18px 48px;
    }

    .stage{
      width:min(1100px, 100%);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      align-items:stretch;
    }

    @media (max-width: 920px){
      .stage{grid-template-columns: 1fr; gap:14px}
    }

    .panel{
      background:var(--glass);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }

    /* neon edge */
    .panel::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 200px at 20% 20%, rgba(124,58,237,.25), transparent 65%),
                  radial-gradient(600px 220px at 80% 10%, rgba(34,211,238,.18), transparent 60%),
                  radial-gradient(560px 240px at 70% 90%, rgba(251,113,133,.12), transparent 60%);
      pointer-events:none;
    }

    .hero{
      padding:26px 26px 22px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,58,237,.9), rgba(34,211,238,.85));
      box-shadow: 0 12px 40px rgba(124,58,237,.25);
      position:relative;
      overflow:hidden;
    }
    .logo::before{
      content:"";
      position:absolute; inset:-30%;
      background: conic-gradient(from 220deg, rgba(255,255,255,.0), rgba(255,255,255,.55), rgba(255,255,255,.0));
      animation: shine 2.6s ease-in-out infinite;
      opacity:.55;
    }
    @keyframes shine{
      0%{transform:translateX(-20%) rotate(0deg)}
      60%{transform:translateX(30%) rotate(30deg)}
      100%{transform:translateX(35%) rotate(40deg)}
    }

    .brand h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
      line-height:1.1;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
    }

    .headline{
      margin:8px 0 0;
      font-size: clamp(28px, 3.2vw, 40px);
      line-height:1.12;
      letter-spacing:.2px;
      font-weight:700;
    }

    .sub{
      margin:0;
      color:rgba(229,231,235,.85);
      font-size:14px;
      line-height:1.7;
      max-width: 56ch;
    }

    .chips{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top:6px;
    }
    .chip{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(2,6,23,.32);
      border:1px solid rgba(255,255,255,.08);
      color:rgba(229,231,235,.9);
      backdrop-filter: blur(8px);
      display:flex; align-items:center; gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--cyan);
      box-shadow: 0 0 14px rgba(34,211,238,.5);
    }
    .dot.p{background:var(--purple); box-shadow:0 0 14px rgba(124,58,237,.5)}
    .dot.k{background:var(--pink); box-shadow:0 0 14px rgba(251,113,133,.45)}

    .ctaRow{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:none;
      border-radius:14px;
      padding:12px 14px;
      font-weight:700;
      cursor:pointer;
      color:var(--text);
      background: rgba(2,6,23,.35);
      border:1px solid rgba(255,255,255,.1);
      display:inline-flex; align-items:center; gap:10px;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(34,211,238,.22); box-shadow: 0 18px 50px rgba(0,0,0,.28);}
    .btnPrimary{
      background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.78));
      border: 1px solid rgba(255,255,255,.16);
    }
    .btnGhost{
      background: transparent;
    }
    .btnSmall{
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
    }
    .hint{
      color:var(--muted);
      font-size:12px;
    }

    /* Right panel (preview / motion) */
    .preview{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .screen{
      flex:1;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:
        linear-gradient(180deg, rgba(2,6,23,.48), rgba(2,6,23,.18)),
        radial-gradient(600px 260px at 20% 25%, rgba(124,58,237,.24), transparent 60%),
        radial-gradient(520px 260px at 80% 20%, rgba(34,211,238,.18), transparent 60%);
      position:relative;
      overflow:hidden;
    }
    .marquee{
      position:absolute; left:18px; right:18px; top:18px;
      padding:14px 14px;
      border-radius:16px;
      background: rgba(15,23,42,.42);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
    }
    .marqueeTitle{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.4px;
    }
    .marqueeTitle span{
      display:inline-block;
      animation: pop 1.6s ease-in-out infinite;
      transform-origin: left bottom;
    }
    .marqueeTitle span:nth-child(2){animation-delay:.12s}
    .marqueeTitle span:nth-child(3){animation-delay:.22s}
    .marqueeTitle span:nth-child(4){animation-delay:.32s}
    @keyframes pop{
      0%,100%{transform:translateY(0)}
      45%{transform:translateY(-4px)}
    }
    .marqueeText{
      margin:8px 0 0;
      color:rgba(229,231,235,.82);
      font-size:13px;
      line-height:1.65;
    }

    .posterRow{
      position:absolute; left:18px; right:18px; bottom:18px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    .poster{
      height:110px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(2,6,23,.38);
      overflow:hidden;
      position:relative;
      transform: translateZ(0);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .poster:hover{ transform: translateY(-2px); box-shadow: 0 18px 60px rgba(0,0,0,.34);}
    .poster::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(240px 120px at 20% 30%, rgba(124,58,237,.25), transparent 65%),
        radial-gradient(240px 120px at 80% 20%, rgba(34,211,238,.20), transparent 60%),
        radial-gradient(240px 140px at 60% 85%, rgba(251,113,133,.12), transparent 60%);
      opacity:.95;
    }
    .poster::after{
      content:"上映中";
      position:absolute; left:12px; top:12px;
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      color:rgba(229,231,235,.9);
      letter-spacing:.4px;
    }

    @media (max-width: 920px){
      .posterRow{ grid-template-columns: 1fr; }
      .poster{ height:90px; }
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(560px, 100%);
      border-radius:20px;
      background: rgba(12,18,35,.78);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(16px);
      box-shadow: 0 40px 160px rgba(0,0,0,.62);
      overflow:hidden;
      transform: scale(.98);
      opacity:.0;
      animation: modalIn .2s ease forwards;
    }
    @keyframes modalIn{
      to{ transform: scale(1); opacity: 1; }
    }
    .modalHead{
      padding:16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .modalHead b{ font-size:14px; letter-spacing:.2px}
    .x{
      cursor:pointer;
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(2,6,23,.35);
      color: rgba(229,231,235,.9);
    }
    .modalBody{ padding:18px; display:flex; flex-direction:column; gap:12px; }
    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .status{
      font-size:12px;
      color: rgba(229,231,235,.85);
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(2,6,23,.28);
      display:inline-flex; gap:8px; align-items:center;
    }
    .status .sDot{
      width:8px;height:8px;border-radius:99px;
      background: rgba(161,161,170,.9);
    }
    .status.ok .sDot{ background: var(--ok); box-shadow:0 0 14px rgba(52,211,153,.45); }

    .err{
      display:none;
      font-size:13px;
      color: rgba(255,255,255,.92);
      background: rgba(251,113,133,.10);
      border:1px solid rgba(251,113,133,.22);
      padding:10px 12px;
      border-radius:14px;
      line-height:1.6;
    }
    .err.show{ display:block; }

    /* Footer */
    .footer{
      margin-top:10px;
      padding: 0 4px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      color: rgba(161,161,170,.9);
      font-size:12px;
      flex-wrap:wrap;
    }
    a{color:rgba(34,211,238,.92); text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="stars"></div>

  <main class="wrap">
    <section class="stage">
      <!-- Left: intro -->
      <div class="panel">
        <div class="hero">
          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <h1>MovieBase</h1>
              <p>漂浮影廳 × 觀影日記（GitHub Pages 前端 + Apps Script 後端）</p>
            </div>
          </div>

          <h2 class="headline">把你的觀影進度、心情、票根，<br>變成一座漂浮影廳。</h2>
          <p class="sub">
            你可以用 Google 登入建立「我的紀錄」，也可以先用訪客模式逛逛漂浮影廳（訪客只能看，不能按讚/留言/發文）。
          </p>

          <div class="chips">
            <div class="chip"><span class="dot p"></span>我的紀錄：已觀看 / 觀看中 / 未觀看</div>
            <div class="chip"><span class="dot"></span>漂浮影廳：貼文牆 + #hashtag 搜尋</div>
            <div class="chip"><span class="dot k"></span>我的帳戶：我的貼文 / 已按讚</div>
          </div>

          <div class="ctaRow">
            <button class="btn btnPrimary" id="btnStart">開始探索（登入/訪客）</button>
            <button class="btn btnGhost" id="btnSkip">Skip Intro</button>
            <span class="hint">（等一下會彈出登入/訪客視窗）</span>
          </div>

          <div class="footer">
            <span>UI：Neon Cinema + Floating Hall（深色玻璃擬態 + 霓虹強調）</span>
            <span>需要協助？<a href="#" id="btnOpenAuth">直接開啟登入視窗</a></span>
          </div>
        </div>
      </div>

      <!-- Right: floating theater preview -->
      <div class="panel">
        <div class="preview">
          <div class="screen" aria-label="漂浮影廳預覽">
            <div class="marquee">
              <div class="marqueeTitle">
                <span>漂</span><span>浮</span><span>影</span><span>廳</span>
                <span style="margin-left:8px; font-weight:700; color:rgba(161,161,170,.9)">Preview</span>
              </div>
              <div class="marqueeText">
                版面像電影院大螢幕，貼文在螢幕內滑動；用 # 搜尋同好心得。<br>
                （登入後：可建立紀錄、發文；訪客：只能觀看）
              </div>
            </div>
            <div class="posterRow" aria-hidden="true">
              <div class="poster"></div>
              <div class="poster"></div>
              <div class="poster"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Auth modal -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="modalHead">
        <b id="authTitle">選擇進入方式</b>
        <div class="x" id="btnClose" aria-label="close">✕</div>
      </div>
      <div class="modalBody">
        <div class="row">
          <div class="status" id="statusPill"><span class="sDot"></span><span id="statusText">目前：未登入</span></div>
          <button class="btn btnSmall" id="btnGuest">以訪客模式進入（只能觀看）</button>
        </div>

        <div class="err" id="errBox"></div>

        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div style="color:rgba(161,161,170,.95); font-size:12px; line-height:1.6">
            登入流程：Google 取得 <b>ID Token</b> → 丟給 Apps Script 驗證 → 成功後進入主站。<br>
            若出現 <b>aud mismatch</b>：代表前端與後端用的 Client ID 不一致。
          </div>
          <div id="gBtn"></div>
        </div>

        <div style="color:rgba(161,161,170,.9); font-size:12px; line-height:1.6">
          小提醒：訪客禁止「我的紀錄」與「按讚/留言/發文」，這會在前後端都鎖住，符合規格。
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== 必改（改成你的）======
    const CLIENT_ID = "709445153038-vh9tvcrk5vtj0r3il5r81j9gl1k68l98.apps.googleusercontent.com";
    const GAS_EXEC_URL = "https://script.google.com/macros/s/AKfycbyuipb05zxPbPp7iAotqe_Oya4je2s-l3COcJ8kDO7e4VHjdLRuNwJhrymkPN02b9Sd/exec"; // 形如 https://script.google.com/macros/s/XXXX/exec
    // ============================

    const overlay = document.getElementById("overlay");
    const errBox = document.getElementById("errBox");
    const statusPill = document.getElementById("statusPill");
    const statusText = document.getElementById("statusText");

    const openModal = () => overlay.classList.add("show");
    const closeModal = () => overlay.classList.remove("show");

    document.getElementById("btnStart").addEventListener("click", openModal);
    document.getElementById("btnOpenAuth").addEventListener("click", (e)=>{ e.preventDefault(); openModal(); });
    document.getElementById("btnClose").addEventListener("click", closeModal);
    document.getElementById("btnSkip").addEventListener("click", openModal);

    // click outside modal to close
    overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });

    function setErr(msg){
      errBox.textContent = msg;
      errBox.classList.add("show");
    }
    function clearErr(){
      errBox.textContent = "";
      errBox.classList.remove("show");
    }
    function setStatus(role, label){
      statusPill.classList.toggle("ok", role === "user");
      statusText.textContent = label;
    }

    async function apiPost(payload){
      // 用 text/plain 避免觸發 CORS preflight（比 application/json 更穩）
      const res = await fetch(GAS_EXEC_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });
      return await res.json();
    }

    function goApp(){
      window.location.href = "./app.html";
    }

    // Guest mode
    document.getElementById("btnGuest").addEventListener("click", ()=>{
      clearErr();
      localStorage.setItem("mb_role", "guest");
      localStorage.removeItem("mb_idToken");
      localStorage.removeItem("mb_user");
      setStatus("guest", "目前：訪客模式");
      goApp();
    });

    // Google sign-in
    window.onload = () => {
      if(!CLIENT_ID || CLIENT_ID.includes("PUT_YOUR")){
        setErr("你還沒填 CLIENT_ID。請把 index.html 上方的 CLIENT_ID 換成 Cloud Console 的 OAuth Client ID。");
        return;
      }
      if(!GAS_EXEC_URL || GAS_EXEC_URL.includes("PUT_YOUR")){
        setErr("你還沒填 GAS_EXEC_URL（/exec）。請把 Apps Script 部署後的 /exec 網址貼上。");
        return;
      }

      google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: async (resp) => {
          clearErr();
          try{
            const idToken = resp.credential;
            const out = await apiPost({ action: "me", idToken });
            if(!out || !out.ok){
              setErr((out && (out.error || out.msg)) ? (out.error || out.msg) : "登入驗證失敗：後端沒有回 ok。");
              setStatus("guest", "目前：未登入");
              return;
            }
            localStorage.setItem("mb_role", "user");
            localStorage.setItem("mb_idToken", idToken);
            localStorage.setItem("mb_user", JSON.stringify(out.user || {}));
            setStatus("user", "目前：已登入（驗證成功）");
            goApp();
          }catch(err){
            setErr("登入流程出錯： " + (err?.message || String(err)));
            setStatus("guest", "目前：未登入");
          }
        }
      });

      google.accounts.id.renderButton(
        document.getElementById("gBtn"),
        {
          theme: "outline",
          size: "large",
          text: "signin_with",
          shape: "pill",
          width: 260
        }
      );

      // If already has session, show status
      const role = localStorage.getItem("mb_role");
      if(role === "user"){
        setStatus("user", "目前：已登入（本機 session）");
      }else if(role === "guest"){
        setStatus("guest", "目前：訪客模式（本機 session）");
      }else{
        setStatus("guest", "目前：未登入");
      }
    };
  </script>
</body>
</html>
