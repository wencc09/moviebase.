<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MovieBase</title>

  <!-- Theme (Step 1) -->
  <link rel="stylesheet" href="assets/theme.css">

  <!-- Google Sign-In (GIS) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* index-only layout */
    header.top{
      position: sticky; top: 0; z-index: 20;
      padding: 14px 0;
      background: linear-gradient(180deg, rgba(7,10,18,.72), rgba(7,10,18,0));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      width:min(1160px, calc(100% - 32px));
      margin: 0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none; color:var(--text);
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, rgba(124,77,255,.95), rgba(0,213,255,.55));
      box-shadow: 0 18px 45px rgba(124,77,255,.18);
      display:grid; place-items:center;
      font-family:"Sora","Noto Sans TC",sans-serif;
      font-weight:700;
    }
    .brandText{ display:flex; flex-direction:column; line-height:1.05; }
    .brandText b{ font-family:"Sora","Noto Sans TC",sans-serif; letter-spacing:.2px; }
    .brandText span{ font-size:12px; color:var(--muted); margin-top:4px; }

    .right{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }
    .state{ font-size:12px; color:var(--muted); border:1px solid var(--stroke); background:rgba(255,255,255,.05); padding:6px 10px; border-radius:999px; }

    .hero{
      padding: 18px 0 6px;
    }
    .heroCard{
      padding: 20px;
      position:relative;
      overflow:hidden;
    }
    .heroCard::after{
      content:"";
      position:absolute; inset:-140px;
      background:
        radial-gradient(circle at 25% 30%, rgba(0,213,255,.22), transparent 60%),
        radial-gradient(circle at 75% 40%, rgba(124,77,255,.22), transparent 60%),
        radial-gradient(circle at 55% 85%, rgba(255,79,216,.14), transparent 60%);
      filter: blur(0px);
      pointer-events:none;
    }
    .heroInner{
      position:relative;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .heroInner{ grid-template-columns: 1fr; }
    }

    .intro{
      padding: 18px;
      display:grid;
      gap: 14px;
    }

    .chips{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top: 4px;
    }

    .stepBox{
      padding: 18px;
      display:grid;
      gap: 12px;
    }
    .stepHead{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .stepTitle{
      font-family:"Sora","Noto Sans TC",sans-serif;
      font-weight:700;
      font-size: 14px;
      color: rgba(255,255,255,.88);
      letter-spacing:.2px;
    }
    .prog{
      height:10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      overflow:hidden;
    }
    .prog > i{
      display:block; height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(124,77,255,.95), rgba(0,213,255,.75));
      transition: width .35s ease;
    }

    .stepK{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px; color:var(--muted);
    }
    .dotRow{ display:flex; gap:6px; }
    .dot{
      width:7px; height:7px; border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
    }
    .dot.is-on{
      background: linear-gradient(135deg, rgba(124,77,255,.95), rgba(0,213,255,.75));
      border-color: rgba(255,255,255,.22);
    }

    .ctaRow{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
    }

    /* Gallery preview */
    .gallery{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 920px){
      .gallery{ grid-template-columns: 1fr 1fr; }
    }
    .shot{
      border-radius: 16px;
      border: 1px solid var(--stroke);
      overflow:hidden;
      background: rgba(255,255,255,.04);
      min-height: 112px;
      position:relative;
    }
    .shot::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(120deg, rgba(124,77,255,.18), transparent 55%),
        radial-gradient(circle at 20% 30%, rgba(0,213,255,.16), transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(255,79,216,.10), transparent 60%);
    }
    .shot b{
      position:absolute; left:12px; bottom:10px;
      font-size:12px; color: rgba(255,255,255,.82);
      font-weight:700;
      font-family:"Sora","Noto Sans TC",sans-serif;
      letter-spacing:.2px;
    }

    /* About section */
    section.block{ margin-top: 18px; }
    .blockCard{ padding: 18px; }
    .cols{
      display:grid; grid-template-columns: 1fr 1fr; gap:14px;
    }
    @media (max-width: 920px){
      .cols{ grid-template-columns: 1fr; }
    }
    .mini{
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
    }
    .mini h3{
      margin:0 0 6px;
      font-family:"Sora","Noto Sans TC",sans-serif;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .mini p{ margin:0; color:var(--muted); font-size:14px; line-height:1.65; }

    /* Modal */
    .modal{
      position:fixed; inset:0; z-index:50;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.55);
      padding: 18px;
    }
    .modal.open{ display:grid; }
    .modalCard{
      width: min(560px, 100%);
      padding: 16px;
    }
    .modalHead{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom: 10px;
    }
    .modalHead b{
      font-family:"Sora","Noto Sans TC",sans-serif;
      letter-spacing:.2px;
      font-size: 16px;
    }
    .modalBody{ display:grid; gap: 10px; }
    .hint{ font-size: 12px; color: var(--muted); line-height:1.6; }
    .gsiWrap{
      border:1px solid var(--stroke);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,.05);
    }
    .rowBtns{ display:flex; gap:10px; flex-wrap:wrap; }
  </style>
</head>

<body>
  <header class="top">
    <div class="topbar">
      <a class="brand" href="./">
        <div class="logo">MB</div>
        <button class="btn" id="themeToggle" type="button">Theme</button>
        <div class="brandText">
          <b>MovieBase</b>
          <span>漂浮影廳｜觀影日記</span>
        </div>
      </a>

      <div class="right">
        <div class="state" id="loginState">目前：未登入</div>
        <button class="btn" id="btnAbout" type="button">看網站介紹</button>
        <button class="btn" id="btnGuest" type="button">以訪客進入</button>
        <button class="btn btn-primary" id="btnLogin" type="button">立即登入</button>
      </div>
    </div>
  </header>

  <div class="wrap hero">
    <div class="glass heroCard">
      <div class="heroInner">
        <div class="glass intro">
          <div class="pill">入口頁</div>
          <h1 class="h1" style="margin-top:6px;">
            把你的觀影進度、心情與票根，
            變成一座漂浮影廳。
          </h1>
          <div class="p">
            登入後可以紀錄、評分、上傳照片、發文分享。
            訪客模式只提供瀏覽，避免寫入資料。
          </div>

          <div class="chips">
            <span class="pill">影集：季集時間碼</span>
            <span class="pill">電影：觀後感</span>
            <span class="pill">票根：照片備份</span>
            <span class="pill">貼文牆：公開分享</span>
          </div>

          <div class="gallery" aria-hidden="true">
            <div class="shot"><b>Glass cards</b></div>
            <div class="shot"><b>Poster layout</b></div>
            <div class="shot"><b>Feed wall</b></div>
          </div>
        </div>

        <div class="glass stepBox" id="introBox">
          <div class="stepHead">
            <div class="stepK">
              <span class="pill" id="stepK">定位</span>
              <div class="dotRow">
                <span class="dot is-on" data-dot="0"></span>
                <span class="dot" data-dot="1"></span>
                <span class="dot" data-dot="2"></span>
              </div>
            </div>

            <div class="rowBtns">
              <button class="btn" id="btnPrev" type="button">上一頁</button>
              <button class="btn" id="btnNext" type="button">下一頁</button>
            </div>
          </div>

          <div class="prog" aria-hidden="true"><i id="bar"></i></div>

          <div class="h2" id="stepT">把觀影進度、心情與票根收進同一個宇宙</div>
          <div class="p" id="stepD">
            用卡片式紀錄你的影集、電影與動畫；一眼看懂最近看了什麼、喜歡什麼。
          </div>

          <div class="ctaRow">
            <button class="btn" id="btnGuest2" type="button" onclick="document.getElementById('btnGuest').click()">以訪客進入</button>
            <button class="btn btn-primary" id="btnLogin2" type="button" onclick="document.getElementById('btnLogin').click()">立即登入</button>
          </div>

          <div class="hint">
            提醒：入口只做介紹與選擇身分。登入視窗只會在你按下「立即登入」後出現。
          </div>
        </div>
      </div>
    </div>

    <section class="block" id="sectionAbout">
      <div class="glass blockCard">
        <div class="pill">網站介紹</div>
        <h2 class="h2" style="margin-top:10px;">你會用到的四個頁面</h2>

        <div class="cols">
          <div class="mini">
            <h3>Hall（主入口）</h3>
            <p>登入後進入功能中樞：導覽到貼文牆、紀錄頁、帳號頁。訪客也能進，但只允許瀏覽。</p>
          </div>
          <div class="mini">
            <h3>Records（我的紀錄）</h3>
            <p>影集與電影的紀錄頁：新增、編輯、上傳照片、篩選搜尋。訪客模式會鎖住寫入按鈕。</p>
          </div>
          <div class="mini">
            <h3>App（貼文牆）</h3>
            <p>公開分享與瀏覽心得。登入才能發文，訪客只能看內容與搜尋。</p>
          </div>
          <div class="mini">
            <h3>Account（帳號）</h3>
            <p>顯示登入狀態與權限，提供登出與模式提醒。</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Modal: Login -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="glass modalCard" role="dialog" aria-modal="true" aria-label="登入視窗">
      <div class="modalHead">
        <div>
          <b>登入 MovieBase</b>
          <div class="hint">登入後才能紀錄與發文。訪客模式只提供瀏覽。</div>
        </div>
        <button class="btn" id="modalClose" type="button">關閉</button>
      </div>

      <div class="modalBody">
        <div class="gsiWrap">
          <!-- 這裡放 Google Sign-In button -->
          <div id="gsiBtn"></div>
          <div class="hint" style="margin-top:8px;">
            若你已成功登入過，會在其他頁面顯示登入狀態；本入口不會自動跳轉。
          </div>
        </div>

        <div class="rowBtns">
          <button class="btn" type="button" onclick="location.href='about.html'">閱讀詳細介紹</button>
          <button class="btn" type="button" onclick="location.href='hall.html?mode=guest'">改用訪客進入</button>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/entry.js"></script>

  <!-- 你原本的 auth/app.js 如果已存在就照用（用來把 token 存起來、驗證後端） -->
  <script src="assets/app.js"></script>

  <script>
    // 入口頁只負責「顯示 Google 按鈕 + 存 token」，不負責自動彈窗
    window.addEventListener("load", () => {
      if (!window.google || !google.accounts?.id) return;

      // 這兩個值應該已經在 assets/app.js 內有，你若有全域 config 可改成讀 config
      const CLIENT_ID = window.MB_CLIENT_ID || window.GOOGLE_CLIENT_ID || "";

      if (!CLIENT_ID) {
        // 沒有 client id 也不要讓頁面掛掉
        return;
      }

      google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: async (resp) => {
          try {
            // 先存 token
            localStorage.setItem("id_token", resp.credential);

            // 如果 assets/app.js 有提供「驗證/取使用者」方法，就用它把名字寫入 localStorage
            if (window.MB && typeof window.MB.me === "function") {
              const me = await window.MB.me(resp.credential);
              if (me && me.name) localStorage.setItem("mb_user_name", me.name);
            }

            // 更新入口狀態
            const name = localStorage.getItem("mb_user_name");
            document.getElementById("loginState").textContent = name ? `目前：已登入（${name}）` : "目前：已登入";

            // 不自動跳走：讓使用者自己選擇要去哪
          } catch (e) {
            console.error(e);
          }
        }
      });

      google.accounts.id.renderButton(document.getElementById("gsiBtn"), {
        theme: "outline",
        size: "large",
        width: 280
      });
    });
  </script>
</body>
</html>
