<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MovieBaseï½œæ¼‚æµ®å½±å»³ Ã— è§€å½±æ—¥è¨˜</title>
  <link rel="stylesheet" href="assets/theme.css">


  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* =============== åŸºæœ¬ =============== */
    :root{
      --bg0:#05070e;
      --bg1:#071a2a;
      --bg2:#2b0a3d;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --shadow: 0 18px 45px rgba(0,0,0,.38);
      --radius: 22px;
      --accent:#7c5cff;
      --accent2:#3ee6ff;
      --ok:#4ade80;
      --warn:#fbbf24;
      --danger:#fb7185;
      --focus: 0 0 0 3px rgba(124,92,255,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "Microsoft JhengHei", Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 650px at 20% 10%, rgba(124,92,255,.32), transparent 55%),
        radial-gradient(900px 520px at 88% 18%, rgba(62,230,255,.18), transparent 55%),
        radial-gradient(900px 600px at 65% 85%, rgba(251,113,133,.14), transparent 60%),
        linear-gradient(120deg, var(--bg0), var(--bg1) 45%, var(--bg2));
      overflow-x:hidden;
    }

    /* é¡†ç²’/åº•ç‰‡ç´‹ç†ï¼ˆä¸å…¨ç™½ã€å¾ˆåƒä½œå“é›†é‚£ç¨®è³ªæ„Ÿï¼‰ */
    .grain{
      position:fixed; inset:-40%;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.7' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.42'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.12;
      transform:rotate(8deg);
      animation: grainMove 10s steps(10) infinite;
    }
    @keyframes grainMove{
      0%{transform:translate3d(0,0,0) rotate(8deg)}
      25%{transform:translate3d(-2%,3%,0) rotate(8deg)}
      50%{transform:translate3d(3%,-2%,0) rotate(8deg)}
      75%{transform:translate3d(-3%,-1%,0) rotate(8deg)}
      100%{transform:translate3d(0,0,0) rotate(8deg)}
    }

    /* æµ®å‹•å…‰é»ï¼ˆæ¼‚æµ®å½±å»³æ„Ÿï¼‰ */
    .orbs{position:fixed; inset:0; pointer-events:none; overflow:hidden;}
    .orb{
      position:absolute; width:22vmin; height:22vmin; border-radius:999px;
      filter: blur(22px);
      opacity:.28;
      animation: float 10s ease-in-out infinite;
    }
    .orb.a{left:-6vmin; top:18vmin; background:rgba(124,92,255,.7)}
    .orb.b{right:-8vmin; top:22vmin; background:rgba(62,230,255,.55); animation-duration:12s}
    .orb.c{left:20vmin; bottom:-10vmin; background:rgba(251,113,133,.55); animation-duration:14s}
    @keyframes float{
      0%,100%{transform:translateY(0) translateX(0) scale(1)}
      50%{transform:translateY(-18px) translateX(12px) scale(1.06)}
    }

    a{color:inherit}
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px 16px;
    }

    /* =============== å…¥å£å®¹å™¨ =============== */
    .stage{
      width:min(1180px, 100%);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .stage{grid-template-columns:1fr; gap:12px;}
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 220px at 20% 12%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(520px 220px at 78% 25%, rgba(62,230,255,.16), transparent 58%);
      opacity:.9;
      pointer-events:none;
    }

    .inner{position:relative; padding:22px;}
    @media (max-width: 520px){
      .inner{padding:18px;}
    }

    /* =============== å·¦å´ï¼šLogo + å¤§ä»‹ç´¹ =============== */
    .brandRow{display:flex; align-items:center; gap:14px; margin-bottom:14px;}
    .logo{
      width:46px; height:46px; border-radius:14px;
      background: linear-gradient(135deg, rgba(124,92,255,.9), rgba(62,230,255,.65));
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      display:grid; place-items:center;
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.6), transparent 55%);
      transform:rotate(20deg);
      opacity:.55;
    }
    .logo span{font-weight:900; letter-spacing:.5px;}
    .brandTitle{display:flex; flex-direction:column; line-height:1.1}
    .brandTitle b{font-size:18px}
    .brandTitle small{color:var(--muted); font-size:12px; margin-top:4px}

    .headline{
      font-size: clamp(26px, 4.1vw, 40px);
      font-weight: 900;
      letter-spacing:.2px;
      margin: 8px 0 12px;
    }
    .sub{
      color:var(--muted);
      line-height:1.7;
      font-size: 14px;
      margin:0 0 16px;
      max-width: 62ch;
    }

    /* ç‰¹è‰² tags */
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .chip{
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(0,0,0,.12);
      color: rgba(255,255,255,.84);
      font-size:12px;
      display:flex; align-items:center; gap:8px;
      backdrop-filter: blur(10px);
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--accent2);
      box-shadow: 0 0 0 3px rgba(62,230,255,.12);
    }

    /* Skip */
    .skip{
      position:fixed;
      right:14px; bottom:14px;
      z-index:30;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.86);
      backdrop-filter: blur(12px);
      cursor:pointer;
      display:flex; align-items:center; gap:8px;
      transition:.2s;
    }
    .skip:hover{transform:translateY(-1px)}
    .skip:focus{outline:none; box-shadow:var(--focus)}

    /* =============== å³å´ï¼šå…¥å£æµç¨‹å¡ï¼ˆé–‹å ´â†’ä»‹ç´¹â†’ä¸€å®šå½ˆç™»å…¥ï¼‰ =============== */
    .flowTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-bottom:12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color: rgba(255,255,255,.86);
      font-size:12px;
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }
    .pulse{
      width:10px;height:10px;border-radius:999px;background:var(--warn);
      box-shadow:0 0 0 0 rgba(251,191,36,.4);
      animation:pulse 1.4s ease-out infinite;
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(251,191,36,.4)}
      100%{box-shadow:0 0 0 12px rgba(251,191,36,0)}
    }

    .screen{
      border-radius: 18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.12));
      padding:16px;
      min-height: 320px;
      display:grid;
      align-content:start;
      gap:12px;
      position:relative;
      overflow:hidden;
    }
    .screen::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 160px at 20% -10%, rgba(62,230,255,.18), transparent 60%);
      pointer-events:none;
    }

    .type{
      font-size:12px;
      color: var(--muted);
      letter-spacing:.16em;
      text-transform:uppercase;
      margin-top:2px;
    }
    .bigline{
      font-size: 16px;
      line-height:1.6;
      margin:0;
      color: rgba(255,255,255,.90);
    }

    .btnRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:6px;}
    .btn{
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      cursor:pointer;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.10);
      border:1px solid var(--line);
      backdrop-filter: blur(12px);
      transition:.18s;
      font-weight:700;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:focus{outline:none; box-shadow:var(--focus)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(62,230,255,.35));
      border-color: rgba(255,255,255,.18);
    }
    .btn.ghost{
      background: rgba(0,0,0,.14);
    }
    .btn small{font-weight:600; opacity:.85}

    /* =============== Modalï¼ˆä¸€å®šå½ˆå‡ºï¼‰ =============== */
    .modalMask{
      position:fixed; inset:0;
      background: rgba(0,0,0,.56);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index:50;
    }
    .modal{
      width:min(540px, 100%);
      border-radius: 22px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(20,22,34,.92), rgba(10,12,20,.82));
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    .modal::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(620px 220px at 20% 0%, rgba(124,92,255,.25), transparent 60%),
        radial-gradient(520px 220px at 90% 30%, rgba(62,230,255,.18), transparent 60%);
      opacity:.95;
      pointer-events:none;
    }
    .modalIn{position:relative; padding:18px;}
    .modalHead{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .modalTitle{font-weight:900; font-size:16px; margin:0;}
    .modalDesc{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.6;}
    .x{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      width:38px; height:38px; border-radius:12px;
      cursor:pointer;
    }
    .x:hover{transform:translateY(-1px)}
    .x:focus{outline:none; box-shadow:var(--focus)}

    .sep{height:1px; background: rgba(255,255,255,.10); margin:14px 0;}
    .hint{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.82);
      font-size:12px;
      line-height:1.6;
    }
    .hint b{color:rgba(255,255,255,.92)}
    .hint .k{padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06)}
    .status{margin-top:10px; font-size:12px; color:var(--muted)}
    .status.ok{color:var(--ok)}
    .status.err{color:var(--danger)}

    /* å°å‹•ç•«ï¼šæ‰“å­—æ„Ÿ */
    .typing{
      display:inline-block;
      position:relative;
      white-space:nowrap;
    }
    .typing::after{
      content:"";
      display:inline-block;
      width:10px;height:16px;margin-left:6px;
      border-right:2px solid rgba(255,255,255,.65);
      transform:translateY(2px);
      animation: blink 1s step-end infinite;
    }
    @keyframes blink{50%{opacity:0}}

    /* é™ä½å‹•æ…‹ï¼ˆç„¡éšœç¤™ï¼‰ */
    @media (prefers-reduced-motion: reduce){
      .grain,.orb{animation:none}
      .typing::after{animation:none}
      .btn:hover,.x:hover,.skip:hover{transform:none}
    }
  </style>
</head>

<body>
  <div class="grain"></div>
  <div class="orbs">
    <div class="orb a"></div>
    <div class="orb b"></div>
    <div class="orb c"></div>
  </div>

  <button class="skip" id="btnSkip" type="button" title="è·³éä»‹ç´¹">
    â¤¼ Skip <span style="opacity:.75">ä»‹ç´¹</span>
  </button>

  <div class="wrap">
    <div class="stage">
      <!-- å·¦ï¼šå¤§ä»‹ç´¹ -->
      <section class="panel">
        <div class="inner">
          <div class="brandRow">
            <!-- ä½ ä¹‹å¾Œå¯ä»¥æŠŠé€™å¡Šæ›æˆè‡ªå·±çš„ logo åœ–ï¼ˆimgï¼‰ -->
            <div class="logo" aria-label="MovieBase Logo">
              <span>MB</span>
            </div>
            <div class="brandTitle">
              <b>MovieBase</b>
              <small>æ¼‚æµ®å½±å»³ Ã— è§€å½±æ—¥è¨˜</small>
            </div>
          </div>

          <div class="headline">
            æŠŠä½ çš„è§€å½±é€²åº¦ã€å¿ƒæƒ…ã€ç¥¨æ ¹ï¼Œ<br/>
            è®Šæˆä¸€åº§<span style="color:var(--accent2)">æ¼‚æµ®å½±å»³</span>ã€‚
          </div>

          <p class="sub">
            é€™å€‹ç¶²ç«™æŠŠã€Œç§äººç´€éŒ„ã€èˆ‡ã€ŒåŒå¥½äº¤æµã€æ”¾åœ¨åŒä¸€å€‹å®‡å®™ï¼š<br/>
            <b>æˆ‘çš„ç´€éŒ„</b>ç”¨ä¾†è¿½åŠ‡/é›»å½±/é›»å½±é™¢ç¥¨æ ¹ï¼›<b>æ¼‚æµ®å½±å»³</b>ç”¨ hashtag æ‰¾åˆ°åŒå¥½ã€åˆ†äº«å¿ƒå¾—ã€‚
            <br/><br/>
            <span class="typing" id="typingText">ï¼ˆç¨å¾Œæœƒè‡ªå‹•è·³åˆ°ä»‹ç´¹ï¼Œç„¶å¾Œä¸€å®šæœƒå½ˆå‡ºç™»å…¥/è¨ªå®¢è¦–çª—ï¼‰</span>
          </p>

          <div class="chips" aria-label="features">
            <div class="chip"><span class="dot"></span> å½±é›†/å‹•æ¼«ï¼šå­£ãƒ»é›†ãƒ»æ™‚é–“ç¢¼</div>
            <div class="chip"><span class="dot" style="background:var(--warn)"></span> é›»å½±ï¼šè§€çœ‹ä¸­ç§’æ•¸ & å·²çœ‹å®Œ</div>
            <div class="chip"><span class="dot" style="background:var(--ok)"></span> é›»å½±é™¢ï¼šæ—¥æœŸ/è©•åˆ†/ç¥¨æ ¹/ç…§ç‰‡</div>
            <div class="chip"><span class="dot" style="background:var(--danger)"></span> è²¼æ–‡ç‰†ï¼šhashtag æœå°‹åŒå¥½</div>
          </div>
        </div>
      </section>

      <!-- å³ï¼šå…¥å£æµç¨‹å¡ -->
      <section class="panel">
        <div class="inner">
          <div class="flowTop">
            <div class="badge"><span class="pulse"></span> å…¥å£æµç¨‹</div>
            <div class="badge" id="modeBadge">ç›®å‰ï¼šæœªç™»å…¥</div>
          </div>

          <div class="screen" id="screen">
            <div class="type">Step 1</div>
            <p class="bigline" id="screenText">
              ä½ æ­£åœ¨é€²å…¥ MovieBase çš„ä¸–ç•Œã€‚<br/>
              å…ˆå¿«é€Ÿçœ‹å®Œä»‹ç´¹ï¼Œæˆ–ç›´æ¥æŒ‰å³ä¸‹è§’ Skipã€‚
            </p>

            <div class="btnRow">
              <button class="btn ghost" id="btnOpenAuth" type="button">ğŸ” ç«‹å³ç™»å…¥ / è¨ªå®¢</button>
              <button class="btn" id="btnGoAbout" type="button">âœ¨ çœ‹ç¶²ç«™ä»‹ç´¹</button>
            </div>

            <div class="hint" style="margin-top:10px;">
              <div class="k">è¦å‰‡</div>
              <div>
                <b>è¨ªå®¢æ¨¡å¼</b>ï¼šåªèƒ½ã€Œçœ‹ã€æ¼‚æµ®å½±å»³ï¼ˆä¸èƒ½ç´€éŒ„ã€ä¸èƒ½ç™¼æ–‡ã€ä¸èƒ½æŒ‰è®šç•™è¨€ï¼‰ã€‚<br/>
                <b>Google ç™»å…¥</b>ï¼šæ‰èƒ½ä½¿ç”¨æˆ‘çš„ç´€éŒ„ã€ç™¼æ–‡ã€äº’å‹•ã€‚
              </div>
            </div>

            <div class="status" id="status"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- ä¸€å®šå½ˆå‡ºçš„ç™»å…¥/è¨ªå®¢ Modal -->
  <div class="modalMask" id="authMask" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="modal">
      <div class="modalIn">
        <div class="modalHead">
          <div>
            <div class="modalTitle" id="authTitle">ç™»å…¥ / è¨ªå®¢æ¨¡å¼</div>
            <div class="modalDesc">
              ä¸ç®¡ä½ æœ‰æ²’æœ‰çœ‹å®Œä»‹ç´¹ï¼Œé€™å€‹è¦–çª—éƒ½æœƒå‡ºç¾ã€‚<br/>
              ä½ å¯ä»¥å…ˆç”¨è¨ªå®¢çœ‹çœ‹æ¼‚æµ®å½±å»³ï¼Œä½†ã€Œç´€éŒ„èˆ‡ç™¼æ–‡ã€å¿…é ˆç™»å…¥ã€‚
            </div>
          </div>
          <button class="x" id="btnCloseAuth" type="button" aria-label="Close">âœ•</button>
        </div>

        <div class="sep"></div>

        <div class="btnRow">
          <button class="btn ghost" id="btnGuest" type="button">
            ğŸ‘€ ä»¥è¨ªå®¢é€²å…¥ <small>ï¼ˆåªèƒ½çœ‹æ¼‚æµ®å½±å»³ï¼‰</small>
          </button>
        </div>

        <div style="height:10px"></div>

        <!-- Google Button æœƒæ¸²æŸ“åœ¨é€™ -->
        <div id="gsiBtn"></div>

        <div class="status" id="authStatus"></div>
      </div>
    </div>
  </div>

  <script>
    /* =========================================================
      âœ… ä½ åªè¦æ”¹é€™è£¡å…©å€‹å€¼ï¼ˆè²¼ä½ çš„ï¼‰
    ========================================================= */
    const CONFIG = {
      // TODO(1)ï¼šè²¼ä½ çš„ Google OAuth Client IDï¼ˆé•·å¾—åƒ xxxx.apps.googleusercontent.comï¼‰
      CLIENT_ID: "709445153038-vh9tvcrk5vtj0r3il5r81j9gl1k68l98.apps.googleusercontent.com",

      // TODO(2)ï¼šè²¼ä½ çš„ Apps Script Web App /exec
      GAS_WEBAPP_URL: "https://script.google.com/macros/s/AKfycbyuipb05zxPbPp7iAotqe_Oya4je2s-l3COcJ8kDO7e4VHjdLRuNwJhrymkPN02b9Sd/exec",

      // å…¥å£æˆåŠŸå¾Œè¦å»çš„ä¸»é ï¼ˆä½ èªª app.html æ˜¯ä¸»æ®¼ï¼‰
      NEXT_PAGE: "./app.html"
    };

    /* =========================================================
      å·¥å…·
    ========================================================= */
    const $ = (id)=>document.getElementById(id);

    function setStatus(msg, type=""){
      const el = $("status");
      el.textContent = msg || "";
      el.className = "status " + type;
    }
    function setAuthStatus(msg, type=""){
      const el = $("authStatus");
      el.textContent = msg || "";
      el.className = "status " + type;
    }
    function openAuth(){
      $("authMask").style.display = "flex";
      setAuthStatus("");
      try { $("btnCloseAuth").focus(); } catch {}
    }
    function closeAuth(){
      $("authMask").style.display = "none";
    }

    function setModeBadge(mode, name){
      if (mode === "guest"){
        $("modeBadge").textContent = "ç›®å‰ï¼šè¨ªå®¢æ¨¡å¼";
      } else if (mode === "user"){
        $("modeBadge").textContent = "ç›®å‰ï¼šGoogle å·²ç™»å…¥" + (name ? `ï¼ˆ${name}ï¼‰` : "");
      } else {
        $("modeBadge").textContent = "ç›®å‰ï¼šæœªç™»å…¥";
      }
    }

    async function apiPOST(payload){
      const res = await fetch(CONFIG.GAS_WEBAPP_URL, {
        method:"POST",
        headers: { "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });
      return await res.json();
    }

    function goNext(){
      location.href = CONFIG.NEXT_PAGE;
    }

    /* =========================================================
      âœ… è¦å‰‡ï¼šè¨ªå®¢ä¸èƒ½ç´€éŒ„/ç™¼æ–‡ï¼ˆå…ˆåœ¨å…¥å£æŠŠèº«åˆ†å¯«å…¥ localStorageï¼‰
      å…¶ä»–é é¢ï¼ˆapp.htmlï¼‰å°±ç”¨é€™å€‹ç‹€æ…‹åšæ¬Šé™æ§åˆ¶
    ========================================================= */
    function loginAsGuest(){
      localStorage.setItem("moviebase_mode", "guest");
      localStorage.removeItem("id_token");
      localStorage.removeItem("moviebase_user");
      setModeBadge("guest");
      setAuthStatus("å·²åˆ‡æ›ç‚ºè¨ªå®¢æ¨¡å¼ï¼šåªèƒ½çœ‹æ¼‚æµ®å½±å»³ âœ…", "ok");
      setTimeout(goNext, 450);
    }

    async function restoreLogin(){
      const token = localStorage.getItem("id_token");
      if (!token){
        setModeBadge("none");
        return;
      }
      try{
        const data = await apiPOST({ action:"me", idToken: token });
        if (!data.ok) throw new Error(data.error || "me failed");
        localStorage.setItem("moviebase_mode","user");
        localStorage.setItem("moviebase_user", JSON.stringify(data.user || {}));
        setModeBadge("user", data.user?.name || data.user?.email || "");
      }catch(e){
        console.warn(e);
        localStorage.removeItem("id_token");
        localStorage.removeItem("moviebase_user");
        localStorage.removeItem("moviebase_mode");
        setModeBadge("none");
      }
    }

    function initGoogle(){
      if (!CONFIG.CLIENT_ID || CONFIG.CLIENT_ID.includes("PASTE_")){
        setAuthStatus("âš ï¸ ä½ é‚„æ²’è²¼ CLIENT_IDï¼ˆè«‹å›åˆ° index.html çš„ TODO è²¼ä¸Šï¼‰", "err");
        return;
      }
      if (!CONFIG.GAS_WEBAPP_URL || CONFIG.GAS_WEBAPP_URL.includes("PASTE_")){
        setAuthStatus("âš ï¸ ä½ é‚„æ²’è²¼ GAS /execï¼ˆè«‹å›åˆ° index.html çš„ TODO è²¼ä¸Šï¼‰", "err");
        return;
      }
      if (!window.google || !google.accounts?.id){
        setAuthStatus("Google SDK å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å¾Œå†è©¦ä¸€æ¬¡ã€‚", "err");
        return;
      }

      google.accounts.id.initialize({
        client_id: CONFIG.CLIENT_ID,
        callback: async (resp) => {
          try{
            localStorage.setItem("id_token", resp.credential);
            const data = await apiPOST({ action:"me", idToken: resp.credential });
            if (!data.ok) throw new Error(data.error || "me failed");

            localStorage.setItem("moviebase_mode","user");
            localStorage.setItem("moviebase_user", JSON.stringify(data.user || {}));
            setModeBadge("user", data.user?.name || data.user?.email || "");
            setAuthStatus("ç™»å…¥æˆåŠŸ âœ… æ­£åœ¨é€²å…¥ç³»çµ±â€¦", "ok");
            setTimeout(goNext, 600);
          }catch(e){
            console.error(e);
            setAuthStatus("ç™»å…¥é©—è­‰å¤±æ•—ï¼ˆè«‹ç¢ºèªå¾Œç«¯ me/Client IDï¼‰", "err");
          }
        }
      });

      google.accounts.id.renderButton($("gsiBtn"), { theme:"outline", size:"large", shape:"pill" });
    }

    /* =========================================================
      å…¥å£å‹•ç•«æµç¨‹ï¼šä¸€å®šæœƒå½ˆå‡ºç™»å…¥/è¨ªå®¢è¦–çª—ï¼ˆç¬¦åˆä½ çš„è¦æ±‚ï¼‰
    ========================================================= */
    function runIntro(){
      // ä½ æƒ³è¦çš„ï¼šlogoâ†’ä»‹ç´¹â†’ä¸€å®šå½ˆçª—
      setStatus("æº–å‚™ä¸­â€¦");
      // è‡ªå‹•åˆ‡æ›æ–‡å­—ï¼ˆå°å‹•ç•«æ„Ÿï¼‰
      const lines = [
        "ä½ æ­£åœ¨é€²å…¥ MovieBase çš„ä¸–ç•Œã€‚",
        "é€™è£¡æœƒæœ‰ï¼šæˆ‘çš„ç´€éŒ„ï¼ˆè¿½åŠ‡/é›»å½±/é›»å½±é™¢ï¼‰ï¼‹ æ¼‚æµ®å½±å»³ï¼ˆè²¼æ–‡ç‰†ï¼‰ã€‚",
        "ä¸ç®¡ä½ æœ‰æ²’æœ‰è·³éä»‹ç´¹ï¼Œéƒ½ä¸€å®šæœƒå½ˆå‡ºç™»å…¥/è¨ªå®¢è¦–çª—ã€‚"
      ];
      let i=0;
      const tick = () => {
        $("screenText").innerHTML = lines[i].replace(/\n/g,"<br/>");
        $("screen").querySelector(".type").textContent = "Step " + (i+1);
        i++;
        if (i < lines.length) setTimeout(tick, 1100);
        else {
          setStatus("å·²è¼‰å…¥å…¥å£æµç¨‹ã€‚", "ok");
          // ç¨ç­‰ä¸€ä¸‹ï¼Œä¸€å®šå½ˆçª—
          setTimeout(openAuth, 650);
        }
      };
      setTimeout(tick, 400);
    }

    /* =========================================================
      äº‹ä»¶
    ========================================================= */
    window.addEventListener("load", async () => {
      $("btnSkip").addEventListener("click", () => {
        // Skip = ç›´æ¥å½ˆçª—ï¼ˆä½†ä¸æœƒè·³éã€Œä¸€å®šå½ˆçª—ã€è¦å‰‡ï¼‰
        setStatus("å·²è·³éä»‹ç´¹ã€‚", "ok");
        openAuth();
      });

      $("btnOpenAuth").addEventListener("click", openAuth);
      $("btnCloseAuth").addEventListener("click", closeAuth);
      $("authMask").addEventListener("click", (e) => {
        if (e.target === $("authMask")) closeAuth();
      });

      $("btnGuest").addEventListener("click", loginAsGuest);

      $("btnGoAbout").addEventListener("click", () => {
        // å…¥å£é å…¶å¯¦å·²ç¶“æ˜¯ä»‹ç´¹ï¼Œå¦‚æœä½ è¦æ›´å®Œæ•´ä»‹ç´¹ï¼Œå¯ä»¥ä¹‹å¾Œåš about.html
        setStatus("ä½ æ­£åœ¨é–±è®€ä»‹ç´¹ï¼šå·¦å´å°±æ˜¯ç¶²ç«™ä»‹ç´¹ã€‚", "ok");
      });

      await restoreLogin();
      initGoogle();
      runIntro();
    });
  </script>
</body>
</html>
