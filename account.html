<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MovieBaseï½œæˆ‘çš„å¸³æˆ¶</title>

  <!-- âœ… CSS é †åºï¼štheme â†’ style -->
  <link rel="stylesheet" href="./assets/theme.css">
  <link rel="stylesheet" href="./assets/style.css" />

  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <div class="bg-float"></div>

  <div class="topbar">
    <div class="nav">
      <div class="brand">
        <div class="logoDot"></div>
        <button class="btn" id="themeToggle" type="button">Theme</button>
        <div class="brandTitle">
          <b>MovieBase</b>
          <span>æˆ‘çš„å¸³æˆ¶</span>
        </div>
      </div>

      <div class="navLinks">
        <a class="pill" data-nav href="about.html">ç¶²ç«™ä»‹ç´¹</a>
        <a class="pill" data-nav href="records.html">æˆ‘çš„ç´€éŒ„</a>
        <a class="pill" data-nav href="hall.html">æ¼‚æµ®å½±å»³</a>
        <a class="pill" data-nav href="account.html">æˆ‘çš„å¸³æˆ¶</a>
      </div>

      <div class="rightBox">
        <span class="badge" id="authBadge">ç›®å‰ï¼šè®€å–ä¸­â€¦</span>
        <img class="avatar" id="authPic" alt="">
        <span class="badge" id="authName">...</span>
        <button class="btn" id="btnOpenLogin" type="button">ç™»å…¥ / è¨ªå®¢</button>
        <button class="btn danger" id="btnLogout" type="button" style="display:none;">ç™»å‡º</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <section class="card">
        <h2>å¸³æˆ¶è³‡è¨Š</h2>
        <div class="muted" id="accInfo">è®€å–ä¸­â€¦</div>
        <div class="hr"></div>
        <div class="muted">
          ä½ è¦æ±‚æ­¤é è¦åˆ—å‡ºï¼š<br>
          ãƒ»è¨ªå®¢/Google ç™»å…¥ç‹€æ…‹<br>
          ãƒ»ç”¨æˆ¶æš±ç¨±ï¼ˆå¯æ”¹ï¼Œé è¨­ Google åå­—ï¼‰<br>
          ãƒ»æˆ‘çš„è²¼æ–‡ï¼ˆå¯ç·¨è¼¯/åˆªé™¤ï¼‰<br>
          ãƒ»å·²æŒ‰è®šè²¼æ–‡ï¼ˆæ”¶è—ï¼‰<br><br>
          é€™äº›æœƒåœ¨ç¬¬ 4 æ­¥å®Œæˆã€‚
        </div>
      </section>

      <section class="card">
        <h2>å¿«é€Ÿå…¥å£</h2>
        <div class="row">
          <a class="btn primary" href="hall.html" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">å»æ¼‚æµ®å½±å»³</a>
          <button class="btn" id="btnGoRecords" type="button">å»æˆ‘çš„ç´€éŒ„</button>
        </div>
        <div class="hr"></div>
        <div class="muted">
          è¨ªå®¢é»ã€Œæˆ‘çš„ç´€éŒ„ã€æœƒè¢«æ“‹ä¸¦è·³ç™»å…¥ï¼ˆç¬¦åˆè¦æ ¼ï¼‰ã€‚
        </div>
      </section>
    </div>
  </div>

  <div class="modal" id="loginModal">
    <div class="modalBox fadeIn">
      <h3>ç™»å…¥ä»¥æŸ¥çœ‹å®Œæ•´å¸³æˆ¶</h3>
      <div class="small">è¨ªå®¢åªé¡¯ç¤ºè¨ªå®¢ç‹€æ…‹ï¼›ç™»å…¥å¾Œæ‰æœƒæœ‰ã€Œæˆ‘çš„è²¼æ–‡ / å·²æŒ‰è®šã€ã€‚</div>
      <div class="hr"></div>
      <div id="gsiBtn"></div>
      <div class="hr"></div>
      <button class="btn" id="btnGuest" type="button">æˆ‘å…ˆç”¨è¨ªå®¢</button>
    </div>
  </div>

  <div class="card">
    <div class="cardTitle">æš±ç¨±</div>
    <div id="nickCurrent" style="margin:8px 0; opacity:.9;"></div>
  
    <div style="display:flex; gap:8px;">
      <input id="nickInput" placeholder="è¼¸å…¥æš±ç¨±ï¼ˆ1~20å­—ï¼‰" style="flex:1;" />
      <button id="nickSave" class="btn">ä¿å­˜</button>
    </div>
  </div>


  <div class="toast" id="toast"></div>

  <script src="./assets/app.js" defer></script>

  <script>
    function waitForMBReady(timeoutMs = 6000){
      const start = Date.now();
      return new Promise((resolve)=>{
        const tick = ()=>{
          if(window.MB && MB.state && MB.state.mode && MB.state.mode !== "unknown") return resolve(true);
          if(Date.now() - start > timeoutMs) return resolve(false);
          setTimeout(tick, 80);
        };
        tick();
      });
    }

  <section class="card" id="nickCard" style="margin-top:12px; display:none;">
    <div class="cardTitle">æš±ç¨±è¨­å®š</div>
    <div class="muted" id="nickStatus" style="margin:8px 0;">è®€å–ä¸­...</div>
  
    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <input id="nicknameInput" type="text" maxlength="30"
        placeholder="è¼¸å…¥ä½ çš„æš±ç¨±ï¼ˆæœ€å¤š30å­—ï¼‰"
        style="flex:1; min-width:220px;"
      />
      <button class="btn" id="btnSaveNickname" type="button">å„²å­˜</button>
    </div>
  
    <div class="muted" style="margin-top:8px;">
      â€» æš±ç¨±æœƒç”¨æ–¼è²¼æ–‡/ç•™è¨€é¡¯ç¤º
    </div>
  </section>


    window.addEventListener("load", async ()=>{
      await waitForMBReady();

      const info = document.getElementById("accInfo");
      const isUser = (MB.state.mode === "user" && MB.state.user);

      if(isUser){
        const nm = MB.state.user.name || MB.state.user.email || "";
        info.innerHTML = `âœ… å·²ç™»å…¥<br>æš±ç¨±ï¼š<b>${nm}</b>`;
      }else{
        info.innerHTML = `ğŸ‘€ è¨ªå®¢æ¨¡å¼ï¼ˆåªèƒ½è§€çœ‹ï¼‰<br>ç™»å…¥å¾Œæ‰å¯æŸ¥çœ‹ï¼šæˆ‘çš„è²¼æ–‡ / å·²æŒ‰è®šè²¼æ–‡`;
      }

      document.getElementById("btnGoRecords").addEventListener("click", ()=>{
        if(!MB_requireLogin("æˆ‘çš„ç´€éŒ„")) return;
        location.href = "records.html";
      });

      // âœ… è¨ªå®¢æŒ‰éˆ•ï¼šé—œ modal + ä¿æŒ guestï¼ˆä¸è¦å¡ä½ï¼‰
      document.getElementById("btnGuest")?.addEventListener("click", ()=>{
        localStorage.setItem("mode","guest");
        // é—œé–‰ loginModalï¼ˆapp.js æœ‰ closeLoginModalï¼Œä½†æ²’æ›å…‰ï¼Œæˆ‘å€‘ç”¨ class ç§»é™¤ï¼‰
        document.getElementById("loginModal")?.classList.remove("is-open");
        toast("å·²ç”¨è¨ªå®¢æ¨¡å¼ç€è¦½å¸³æˆ¶");
      });
    });
  </script>
</body>
</html>
